## ETL with dbt and DuckDB

Lightweight local ETL using dbt Core and DuckDB. It transforms raw customer shopping data into an analytics-ready star schema.

## Overview

- Extract raw transactions from CSV
- Load into a local DuckDB database
- Transform with dbt into dimensions and fact tables


## Quick start

1) Clone and enter the project

```bash
git clone https://github.com/wissemhammoudi/etl-using-Dbt-and-DuckDB.git
cd etlDbtDuckdb
```

2) Create a virtual environment and install dependencies

```bash
python -m venv myenv
source myenv/bin/activate
pip install -r requirement.txt
```

3) Configure dbt profile

Create or edit `~/.dbt/profiles.yml` with the following profile (matches `dbt_etl/dbt_project.yml`):

```yaml
dbt_etl:
  target: dev
  outputs:
    dev:
      type: duckdb
      # When running commands from the dbt project folder (`dbt_etl/`),
      # this relative path points to the database in that folder
      path: dev.duckdb
```

If you prefer an absolute path, set `path` to the full path to `dev.duckdb`.

## Project structure

```
etlDbtDuckdb/
├── Readme.md
├── requirement.txt
└── dbt_etl/
    ├── dbt_project.yml
    ├── dev.duckdb
    ├── data/
    │   └── customer_shopping_data.csv
    ├── models/
    │   ├── staging/
    │   │   └── stg_customer_shopping.sql
    │   └── marts/
    │       ├── dim_*.sql /.yml
    │       └── fact_sales.sql /.yml
    └── logs/ ... target/ ... (generated by dbt)
```

## Usage

Run all commands from the `dbt_etl/` directory.

1) Load the raw CSV into DuckDB

```bash
cd dbt_etl
python - <<'PY'
import duckdb
import pandas as pd
conn = duckdb.connect('./dev.duckdb')
df = pd.read_csv('./data/customer_shopping_data.csv')
df['invoice_date'] = pd.to_datetime(df['invoice_date'], format='%d/%m/%Y').dt.strftime('%Y-%m-%d')
conn.execute("DROP TABLE IF EXISTS raw_customer_shopping;")
conn.execute("CREATE TABLE raw_customer_shopping AS SELECT * FROM df;")
print(conn.execute("SELECT * FROM raw_customer_shopping LIMIT 5;").fetchall())
conn.close()
PY
```

Notes:
- The script expects `data/customer_shopping_data.csv`
- It writes a table `raw_customer_shopping` into `dev.duckdb`

2) Run dbt transformations and tests

```bash
dbt run
dbt test
```

3) Explore docs

```bash
dbt docs generate
dbt docs serve
```

### Detailed documentation

See full details about the source data, staging logic, dimensions, fact model, and tests in:

[`DATA_AND_TRANSFORMATIONS.md`](./DATA_AND_TRANSFORMATIONS.md)

 
